import{j as e}from"./index-DH-cTe4E.js";import{r as l,L as W}from"./react-vendor-BdF-CjAN.js";import{u as H}from"./useAudioEngine-DEbr_Whe.js";import{g as z,c as f,b as D,d as P,e as $,f as I,h as V,u as K,a as q}from"./useRoomClassifier-C-Gjq7GR.js";import"./tensorflow-obHFcFBr.js";function U(){const[x,i]=l.useState({samples:[],isLoading:!0,error:null,canTrain:!1,trainingMessage:"Loading..."}),p=l.useCallback(async()=>{i(r=>({...r,isLoading:!0,error:null}));try{const[r,t]=await Promise.all([z(),f()]);i({samples:r,isLoading:!1,error:null,canTrain:t.canTrain,trainingMessage:t.message})}catch(r){const t=r instanceof Error?r.message:"Failed to load samples";i(n=>({...n,isLoading:!1,error:t}))}},[]);l.useEffect(()=>{p()},[p]);const g=l.useCallback(async(r,t,n)=>{try{const a=await D(r,t,n);i(d=>({...d,samples:[...d.samples,a],error:null}));const h=await f();return i(d=>({...d,canTrain:h.canTrain,trainingMessage:h.message})),a}catch(a){const h=a instanceof Error?a.message:"Failed to save sample";return i(d=>({...d,error:h})),null}},[]),c=l.useCallback(async r=>{try{await P(r),i(n=>({...n,samples:n.samples.filter(a=>a.id!==r),error:null}));const t=await f();return i(n=>({...n,canTrain:t.canTrain,trainingMessage:t.message})),!0}catch(t){const n=t instanceof Error?t.message:"Failed to delete sample";return i(a=>({...a,error:n})),!1}},[]),y=l.useCallback(async r=>{try{const t=await $(r);i(a=>({...a,samples:a.samples.filter(h=>h.roomId!==r),error:null}));const n=await f();return i(a=>({...a,canTrain:n.canTrain,trainingMessage:n.message})),t}catch(t){const n=t instanceof Error?t.message:"Failed to delete samples";return i(a=>({...a,error:n})),0}},[]),v=l.useCallback(async r=>{try{return await I(r)}catch(t){return console.error("Failed to get samples for room:",t),[]}},[]),k=l.useCallback(async()=>{const r=await f();return i(t=>({...t,canTrain:r.canTrain,trainingMessage:r.message})),r},[]),N=l.useCallback(async()=>await V(),[]);return{state:x,addSample:g,removeSample:c,removeSamplesForRoom:y,getSamplesForRoom:v,checkTrainingReadiness:k,getTrainingData:N,refreshSamples:p}}function X(){const{state:x,addRoom:i,removeRoom:p,refreshRooms:g}=K(),{state:c,capture:y,requestPermission:v,reset:k}=H(),{state:N,addSample:r,getTrainingData:t,refreshSamples:n}=U(),{state:a,train:h}=q(),[d,m]=l.useState("list"),[b,C]=l.useState(""),[j,L]=l.useState(null),[u,S]=l.useState("audible"),[w,T]=l.useState(0);l.useEffect(()=>{d==="list"&&g()},[d,g]);const M=async()=>{if(!b.trim())return;await i(b.trim())&&(C(""),m("list"))},R=async s=>{L(s),T(0),!(!c.hasPermission&&!await v())&&m("capture")},F=async()=>{if(!j)return;k();const s=await y(u);s&&(await r(j.id,s.raw,{chirpMode:u,duration:u==="audible"?500:300,sampleRate:48e3,deviceInfo:navigator.userAgent}),T(o=>o+1),await g())},E=async()=>{m("training");const{features:s,labels:o,roomIds:B}=await t();await h(s,o,B),await n()},A=async s=>{confirm("Delete this room and all its samples?")&&await p(s)};if(d==="add-room")return e.jsxs("div",{className:"page safe-top",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>m("list"),className:"btn-ghost p-2",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-xl font-bold",children:"Add Room"})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"card",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-300",children:"Room Name"}),e.jsx("input",{type:"text",value:b,onChange:s=>C(s.target.value),placeholder:"e.g., Living Room, Kitchen",className:"w-full px-4 py-3 bg-dark-700 border border-dark-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-primary-500",autoFocus:!0}),x.error&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:x.error}),e.jsx("button",{onClick:M,disabled:!b.trim(),className:"btn-primary w-full mt-4",children:"Create Room"})]})})]});if(d==="capture"&&j)return e.jsxs("div",{className:"page safe-top",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>m("list"),className:"btn-ghost p-2",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("h1",{className:"text-xl font-bold",children:["Capture: ",j.name]})]}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"card text-center mb-6",children:[e.jsx("div",{className:"text-6xl font-bold text-primary-400 mb-2",children:j.sampleCount+w}),e.jsx("p",{className:"text-gray-400",children:"samples captured"}),w>0&&e.jsxs("p",{className:"text-sm text-accent-400 mt-1",children:["+",w," this session"]})]}),e.jsxs("div",{className:"card mb-6",children:[e.jsx("h2",{className:"section-title",children:"Chirp Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>S("audible"),className:`py-2 px-4 rounded-lg transition-colors ${u==="audible"?"bg-primary-600 text-white":"bg-dark-700 text-gray-400"}`,children:"Audible"}),e.jsx("button",{onClick:()=>S("ultrasonic"),className:`py-2 px-4 rounded-lg transition-colors ${u==="ultrasonic"?"bg-primary-600 text-white":"bg-dark-700 text-gray-400"}`,children:"Ultrasonic"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:u==="audible"?"Higher accuracy, audible sound (200Hz-18kHz)":"Less audible, reduced accuracy (15kHz-20kHz)"})]}),e.jsxs("button",{onClick:F,disabled:c.captureState==="capturing"||c.captureState==="processing",className:`w-full py-6 rounded-xl text-xl font-bold transition-all ${c.captureState==="capturing"||c.captureState==="processing"?"bg-accent-600 text-white animate-pulse":"bg-primary-600 hover:bg-primary-500 text-white glow-primary"}`,children:[c.captureState==="idle"&&e.jsxs("span",{className:"flex items-center justify-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),"Tap to Capture"]}),c.captureState==="capturing"&&"Listening...",c.captureState==="processing"&&"Processing...",c.captureState==="complete"&&e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Saved! Tap for more"]})]}),c.error&&e.jsx("p",{className:"mt-4 text-center text-red-400 text-sm",children:c.error}),e.jsxs("div",{className:"card mt-6",children:[e.jsx("h2",{className:"section-title",children:"Capture Tips"}),e.jsxs("ul",{className:"text-sm text-gray-400 space-y-2",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-accent-400",children:"•"}),"Hold phone steady at chest height"]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-accent-400",children:"•"}),"Try different positions in the room"]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-accent-400",children:"•"}),"Minimize background noise"]})]})]}),e.jsx("button",{onClick:()=>m("list"),className:"btn-secondary w-full mt-4",children:"Done Capturing"})]})]});if(d==="training"){const s=a.trainingProgress,o=a.lastTrainingResult;return e.jsxs("div",{className:"page safe-top",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>m("list"),className:"btn-ghost p-2",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-xl font-bold",children:"Training Model"})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"card",children:[a.isTraining&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"text-4xl font-bold text-primary-400 mb-1",children:[Math.round(s.epoch/s.totalEpochs*100),"%"]}),e.jsxs("p",{className:"text-gray-400",children:["Epoch ",s.epoch,"/",s.totalEpochs]})]}),e.jsx("div",{className:"w-full h-3 bg-dark-700 rounded-full overflow-hidden mb-4",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary-600 to-accent-500 transition-all duration-300",style:{width:`${s.epoch/s.totalEpochs*100}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-accent-400",children:[(s.accuracy*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Accuracy"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-300",children:s.loss.toFixed(4)}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loss"})]})]})]}),!a.isTraining&&o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center mb-6",children:o.success?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-green-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h2",{className:"text-xl font-bold text-green-400",children:"Training Complete!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-red-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h2",{className:"text-xl font-bold text-red-400",children:"Training Failed"}),e.jsx("p",{className:"text-gray-400 mt-2",children:o.error})]})}),o.success&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-accent-400",children:[(o.finalAccuracy*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Final Accuracy"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-300",children:o.epochs}),e.jsx("p",{className:"text-sm text-gray-500",children:"Epochs"})]})]}),e.jsx("button",{onClick:()=>m("list"),className:"btn-primary w-full",children:o.success?"Start Detecting":"Back to Training"})]}),!a.isTraining&&!o&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Preparing training data..."})]})]})})]})}return e.jsxs("div",{className:"page safe-top",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-6",children:[e.jsx(W,{to:"/",className:"btn-ghost p-2",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-xl font-bold",children:"Train Rooms"})]}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>m("add-room"),className:"btn-primary w-full mb-6",children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add New Room"]})}),x.isLoading&&e.jsx("div",{className:"card text-center py-8",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full mx-auto"})}),!x.isLoading&&x.rooms.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:"No Rooms Yet"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Add your first room to start training the acoustic classifier"})]}):e.jsx("div",{className:"space-y-3",children:x.rooms.map(s=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsxs("p",{className:`text-sm ${s.sampleCount>=5?"text-green-400":"text-gray-500"}`,children:[s.sampleCount," sample",s.sampleCount!==1?"s":"",s.sampleCount<5&&` (need ${5-s.sampleCount} more)`]})]}),e.jsx("button",{onClick:()=>A(s.id),className:"btn-ghost p-2 text-gray-500 hover:text-red-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("button",{onClick:()=>R(s),className:"btn-secondary w-full text-sm",children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),"Capture Samples"]})})]},s.id))}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"section-title",children:"Model Training"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:N.trainingMessage}),e.jsx("button",{onClick:E,className:"btn-accent w-full",disabled:!N.canTrain||a.isTraining,children:a.isTraining?"Training...":"Train Model"}),a.modelInfo&&e.jsxs("p",{className:"text-xs text-center text-gray-500 mt-2",children:["Current model: ",a.modelInfo.roomCount," rooms, ",(a.modelInfo.accuracy*100).toFixed(0),"% accuracy"]})]})}),e.jsxs("div",{className:"card mt-6",children:[e.jsx("h2",{className:"section-title",children:"Training Tips"}),e.jsxs("ul",{className:"text-sm text-gray-400 space-y-2",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-accent-400",children:"•"}),"Capture samples from different positions in each room"]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-accent-400",children:"•"}),"Keep background noise consistent during capture"]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-accent-400",children:"•"}),"More samples = better accuracy (10+ recommended)"]})]})]})]})]})}export{X as default};
//# sourceMappingURL=TrainingPage-yLRNMBjA.js.map
