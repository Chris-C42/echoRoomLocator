import{j as e}from"./index-DH-cTe4E.js";import{r as o,L}from"./react-vendor-BdF-CjAN.js";import{u as A}from"./useAudioEngine-DEbr_Whe.js";import{a as E,u as I}from"./useRoomClassifier-C-Gjq7GR.js";import"./tensorflow-obHFcFBr.js";function V(){var w,k;const{state:l,capture:M,requestPermission:C,reset:S}=A(),{state:x,predict:R}=E(),{state:g,getRoomById:f}=I(),[s,r]=o.useState("idle"),[c,j]=o.useState("audible"),[a,b]=o.useState(null),[F,y]=o.useState(null),[N,v]=o.useState([]),[$,d]=o.useState(null),m=x.modelState==="ready";o.useEffect(()=>{l.captureState==="capturing"?r("listening"):l.captureState==="processing"&&r("processing")},[l.captureState]);const D=async()=>{if(!m){d("No model trained. Please train a model first."),r("error");return}if(!l.hasPermission&&!await C()){d("Microphone permission denied"),r("error");return}d(null),b(null),y(null),v([]),S();const t=await M(c);if(!t){d(l.error||"Failed to capture audio"),r("error");return}r("processing");const i=await R(t.raw);if(!i){d(x.error||"Prediction failed"),r("error");return}const n=f(i.predictedRoomId);y((n==null?void 0:n.name)||i.predictedRoomId),b(i);const p=[];i.allProbabilities.forEach((u,h)=>{h!==i.predictedRoomId&&p.push({roomId:h,probability:u})}),p.sort((u,h)=>h.probability-u.probability),v(p),r("result")},B=t=>t>=.8?"text-green-400":t>=.6?"text-yellow-400":"text-red-400",P=t=>t>=.8?"High confidence":t>=.6?"Medium confidence":"Low confidence";return e.jsxs("div",{className:"page safe-top",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-6",children:[e.jsx(L,{to:"/",className:"btn-ghost p-2",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-xl font-bold",children:"Detect Room"})]}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"card text-center py-12",children:[s==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full bg-dark-700 flex items-center justify-center",children:e.jsx("svg",{className:"w-16 h-16 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsx("p",{className:"text-gray-400 mb-6",children:m?"Tap to detect which room you're in":"Train a model to start detecting"})]}),s==="listening"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full bg-primary-600/20 flex items-center justify-center animate-pulse-slow glow-primary",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary-600/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})})}),e.jsx("p",{className:"text-primary-400 mb-6",children:"Emitting chirp & listening..."})]}),s==="processing"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full bg-accent-600/20 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-accent-500 border-t-transparent rounded-full animate-spin"})}),e.jsx("p",{className:"text-accent-400 mb-6",children:"Analyzing acoustic signature..."})]}),s==="result"&&a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`w-32 h-32 mx-auto mb-6 rounded-full flex items-center justify-center ${a.confidence>=.6?"bg-accent-600/20 glow-accent":"bg-yellow-600/20"}`,children:e.jsx("svg",{className:`w-16 h-16 ${a.confidence>=.6?"text-accent-400":"text-yellow-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${a.confidence>=.6?"text-accent-400":"text-yellow-400"}`,children:F}),e.jsxs("p",{className:`text-lg font-medium mb-1 ${B(a.confidence)}`,children:[(a.confidence*100).toFixed(0),"% confidence"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:P(a.confidence)}),N.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-600",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Other possibilities:"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:N.slice(0,3).map((t,i)=>{const n=f(t.roomId);return e.jsxs("span",{className:"text-xs bg-dark-700 px-2 py-1 rounded",children:[(n==null?void 0:n.name)||t.roomId,": ",(t.probability*100).toFixed(0),"%"]},i)})})]})]}),s==="error"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full bg-red-600/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-16 h-16 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-bold text-red-400 mb-2",children:"Detection Failed"}),e.jsx("p",{className:"text-gray-400 mb-6",children:$})]}),e.jsxs("button",{onClick:D,disabled:s==="listening"||s==="processing",className:`btn-primary w-full text-lg py-4 ${s==="idle"&&m?"glow-primary":""} ${m?"":"opacity-50"}`,children:[s==="idle"&&"Detect Room",s==="listening"&&"Listening...",s==="processing"&&"Processing...",s==="result"&&"Detect Again",s==="error"&&"Try Again"]})]}),e.jsxs("div",{className:"card mt-6",children:[e.jsx("h2",{className:"section-title",children:"Detection Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>j("audible"),className:`btn-secondary text-sm py-3 ${c==="audible"?"border-primary-500 bg-primary-600/10":""}`,children:[e.jsx("div",{className:`font-medium ${c==="audible"?"text-primary-400":""}`,children:"Audible"}),e.jsx("div",{className:"text-xs text-gray-500",children:"High accuracy"})]}),e.jsxs("button",{onClick:()=>j("ultrasonic"),className:`btn-secondary text-sm py-3 ${c==="ultrasonic"?"border-primary-500 bg-primary-600/10":""}`,children:[e.jsx("div",{className:`font-medium ${c==="ultrasonic"?"text-primary-400":""}`,children:"Ultrasonic"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Less audible"})]})]})]}),m?e.jsx("div",{className:"card mt-6 border-green-600/50 bg-green-600/10",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-green-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-500",children:"Model Ready"}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[(w=x.modelInfo)==null?void 0:w.roomCount," rooms trained, ",((((k=x.modelInfo)==null?void 0:k.accuracy)||0)*100).toFixed(0),"% accuracy"]})]})]})}):e.jsx("div",{className:"card mt-6 border-yellow-600/50 bg-yellow-600/10",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-yellow-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-500",children:"No Model Trained"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Go to Training to add rooms and train the classifier."}),e.jsx(L,{to:"/training",className:"text-sm text-primary-400 hover:text-primary-300 mt-2 inline-block",children:"Go to Training â†’"})]})]})}),g.rooms.length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("h2",{className:"section-title",children:"Trained Rooms"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.rooms.map(t=>e.jsx("span",{className:"text-sm bg-dark-700 px-3 py-1 rounded-full text-gray-300",children:t.name},t.id))})]})]})]})}export{V as default};
//# sourceMappingURL=DetectionPage-DoCjFBKY.js.map
